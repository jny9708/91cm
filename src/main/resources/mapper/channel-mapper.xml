<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nineone.nocm.mapper.channel">
    <select id="getChannel" parameterType="java.lang.Integer" resultType="com.nineone.nocm.domain.Channel">
        SELECT *
          FROM CHANNEL
         WHERE DELETE_YN = 'N'
           AND ID = #{id}
    </select>

    <insert id="insertChannel" useGeneratedKeys="true" keyProperty="id">
        INSERT CHANNEL ( NAME
              ) VALUES ( #{name}
              )
    </insert>

    <update id="updateChannel">
        UPDATE CHANNEL SET NAME = #{name}
                     WHERE ID = #{id}
    </update>

    <delete id="deleteChannel">
        UPDATE CHANNEL
           SET DELETE_YN = 'Y'
         WHERE ID = #{channelId}
    </delete>

    <select id="channelList" resultType="com.nineone.nocm.domain.Channel">
        SELECT CN.ID
             , CN.NAME
             , CN.REGISTER_DATE
             , JI.MEMBER_EMAIL AS LOGIN_EMAIL
          FROM CHANNEL AS CN

    INNER JOIN JOININFO JI
            ON JI.CHANNEL_ID = CN.ID
           AND JI.MEMBER_EMAIL = #{userEmail}

         WHERE CN.DELETE_YN = 'N'

      ORDER BY LENGTH(CN.NAME) ASC
             , CN.NAME ASC
    </select>

    <insert id="insertJoinInfo">
        INSERT JOININFO ( CHANNEL_ID
                        , MEMBER_EMAIL
               ) VALUES ( #{channel_id}
                        , #{member_email}
               )
    </insert>

    <select id="channelListAll" resultType="com.nineone.nocm.domain.Channel">
        SELECT *
          FROM CHANNEL
         WHERE DELETE_YN = 'N';
    </select>
</mapper>